format_version: "11"
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git

workflows:
  build-apk:
    steps:
      - activate-ssh-key@4: {}
      - git-clone@8: {}
      - script@1:
          title: Auto Fix Project (No Ribet)
          inputs:
            - content: |-
                #!/bin/bash
                set -e
                MANIFEST="app/src/main/AndroidManifest.xml"

                echo "‚û°Ô∏è Bersihin semua ikon custom..."
                rm -rf app/src/main/res/mipmap-*
                rm -f app/src/main/res/drawable/ic_launcher.png || true
                rm -f app/src/main/res/drawable/ic_launcher_round.png || true

                echo "‚û°Ô∏è Update AndroidManifest.xml pake ikon default..."
                sed -i 's/android:icon="[^"]*"/android:icon="@android:drawable\/sym_def_app_icon"/' $MANIFEST || true
                sed -i 's/android:roundIcon="[^"]*"/android:roundIcon="@android:drawable\/sym_def_app_icon"/' $MANIFEST || true
                sed -i 's/android:theme="[^"]*"/android:theme="@android:style\/Theme.Light"/' $MANIFEST || true

                echo "üéâ Semua fix bro! Sekarang project pake ikon default bawaan Android ü§ñ"

      - install-missing-android-tools@3:
          inputs:
            - gradlew_path: "./gradlew"

      - gradle-runner@2:
          title: Build APK Release
          inputs:
            - gradle_task: "assembleRelease"

      - deploy-to-bitrise-io@2: {}
      
